<!DOCTYPE html>
<html>

<head>
    <title>Realtime AI Chat</title>
</head>

<body>
    <h1>Realtime AI Chat</h1>
    <form action="" onsubmit="sendMessage(event)">
        <select name="request" id="request">
            <option value="config.update">config.update</option>
            <option value="buffer.add_audio">buffer.add_audio</option>
            <option value="buffer.clear_audio">buffer.clear_audio</option>
            <option value="generate.text_audio">generate.text_audio</option>
            <option value="generate.only_text">generate.only_text</option>
            <option value="generate.cancel">generate.cancel</option>
        </select>
        <div>
            <textarea type="text" id="messageText" autocomplete="off">{"org": "abcd"}</textarea>
        </div>
        <button>Send</button>
    </form>
    <ul id='messages'>
    </ul>
    <script>
        var ws = new WebSocket("ws://" + location.host);
        ws.onmessage = function (event) {
            var messages = document.getElementById('messages')
            var message = document.createElement('li')
            var content = document.createTextNode("receive: " + event.data)
            message.appendChild(content)
            messages.appendChild(message)
        };
        function sendMessage(event) {
            var input = document.getElementById("messageText")
            try {
                data = JSON.parse(input.value)
            } catch {
                alert("json 형식");
                return;
            }
            type = { "type": document.querySelector("#request").value }
            payload = { ...type, ...data }
            ws.send(JSON.stringify(payload))

            var messages = document.getElementById('messages')
            var message = document.createElement('li')
            var content = document.createTextNode("send: " + JSON.stringify(payload))
            message.appendChild(content)
            messages.appendChild(message)

            if (payload.type == "config.update") {
                document.querySelector("#request").value = "generate.text_audio";
                input.value = '{"text": "메타버스아카데미에 대해 소개해줘"}';
            }
            else {
                input.value = '{}';
            }
            event.preventDefault()
        }
    </script>
</body>

</html>